<%+header%>

<div class="cbi-map">
    <h2 name="content"><%:Network Switcher Log%></h2>
    
    <div class="cbi-map-descr">
        <%:View the network switcher service logs.%>
    </div>
    
    <fieldset class="cbi-section">
        <legend><%:Service Log%></legend>
        <div class="cbi-value">
            <div class="cbi-value-field">
                <button class="cbi-button cbi-button-reload" onclick="refreshLog()">
                    <%:Refresh Log%>
                </button>
                <button class="cbi-button cbi-button-reset" onclick="clearLog()">
                    <%:Clear Log%>
                </button>
            </div>
        </div>
        
        <pre id="log-content" style="min-height: 400px; background: #f5f5f5; padding: 10px; border-radius: 3px; font-family: monospace; white-space: pre-wrap; overflow: auto;"></pre>
    </fieldset>
</div>

<script>
// 页面加载时获取日志
window.onload = function() {
    refreshLog();
};

function refreshLog() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', '<%=luci.dispatcher.build_url("admin/services/network_switcher/get_log")%>', true);
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
            document.getElementById('log-content').textContent = xhr.responseText;
        }
    };
    xhr.send();
}

function clearLog() {
    if (confirm('<%:Are you sure you want to clear the log?%>')) {
        // 这里需要实现清空日志的功能
        // 由于安全考虑，可能需要通过后端API实现
        alert('<%:Log clearing feature needs to be implemented in the backend.%>');
    }
}

// 每10秒自动刷新日志
setInterval(refreshLog, 10000);
</script>

<%+footer%>
